{% extends 'flashcards_base.html' %}
{% load staticfiles %}

{% block content_block %}
<div id="ng" ng-app="proso" ng-controller="auth">
    <h4>Flashcard</h4>
    <div class="pure-button pure-button-primary" ng-click="get_flashcard()">Get flashcard</div>
    <p>{% verbatim %}{{ msg }}{% endverbatim %}</p>
    <div class="fc">
        Flashcard id: {% verbatim %}{{ flashcard.id }}{% endverbatim %}
        <pre>{% verbatim %}{{ flashcard | json:4 }}{% endverbatim %}</pre>
    </div>
    <div ng-show="flashcard">
        <hr/>
        <h4>Answer</h4>
        <form ng-submit="service.save_answer_to_current_fc(answer.id, answer.rt, answer.meta)">
            <input type="number" required ng-model="answer.id" placeholder="FC Answered id"/>
            <input type="number" required ng-model="answer.rt" placeholder="Response time"/>
            <input type="text" ng-model="answer.meta" placeholder="Meta"/>
            <input type="submit" class="pure-button pure-button-primary" value="Save"/>
        </form>
    </div>
    <hr/>
    <h4>Service</h4>
    <pre>Current FC: {% verbatim %}{{ service.get_current() }}{% endverbatim %}</pre>
    <pre>{% verbatim %}{{ service.get_config() | json:4 }}{% endverbatim %}</pre>
</div>
{% endblock %}


{% block head_block %}
    <script src="{% static "proso_common/angular.min.js" %}"></script>
    <script src="{% static "js/practice_service.js" %}"></script>
    <script>
        var app = angular.module('proso', ["proso_apps.services"]);
        app.config(function($httpProvider) {
            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        });
        app.controller("auth", function($scope, practiceService){
            $scope.service = practiceService;

            $scope.get_flashcard = function(){
                practiceService.get_flashcard().then(
                        // called after FC is ready
                        function(flashcard) {
                            $scope.flashcard = flashcard;
                            $scope.msg = "";
                        },
                        // called on error (set complete)
                        function(msg){
                            $scope.flashcard = null;
                            $scope.msg = msg;
                        }
                );
            }
        });

    </script>
    <style>
        .fc { position: relative; cursor: help; }
        .fc pre{
            display: none;
            position: absolute;
            background-color: white;
            border: solid gray 1px;
            left: 20px;
            top: -20px;
        }
        .fc:hover pre{
            display: block;
        }
    </style>
{% endblock %}